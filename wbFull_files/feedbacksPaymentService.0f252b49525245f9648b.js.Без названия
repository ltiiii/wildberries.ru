(()=>{"use strict";const t="https://points.wb.ru/points-users-api/api/";let e=function(){function e(){}var n=e.prototype;return n.fillFeedbacksPayments=async function(t){if(!(null==t?void 0:t.length))return null;const e=new Map,n=[];t.forEach((t=>{const o=t.nmId||t.id;e.set(o,t),n.push(o)}));const o=await this.getFeedbacksPaymentByNms(n);null==o||o.forEach((t=>{const n=e.get(t.item_id);n&&$.observable(n).setProperty({feedbacksPaymentInfo:this._toProductPaymentsInfo(t)})})),WbSpaModel.prototype.$eventBus.dispatchEvent(new CustomEvent("feedbackPaymentsLoaded"))},n.fillFeedbacksPaymentsByUser=async function(t){if(!(null==t?void 0:t.length))return null;const e=await this.getFeedbacksPaymentByUser(),n=new Map;t.forEach((t=>{const e=t.rId;t.feedbackAllowed&&"RU"==t.country&&n.set(e,t)})),null==e||e.forEach((t=>{const e=n.get(t.rid);e&&$.observable(e).setProperty({feedbacksPaymentInfo:this._toProductPaymentsInfo(t)})}))},n.getFeedbacksPaymentByNms=async function(e){const n=`${t}v1/w/promotion/available`,o={item_ids:e},s={method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}},a={noProcessResponse:!0};try{const t=await this.$httpClient.fetchBasicJSON(n,s,a);return null==t?void 0:t.promotion_items}catch(t){return console.log("Ошибка получения данных о товарах с бонусами за отзыв"),null}},n.getFeedbacksPaymentByUser=async function(){const e=`${t}v1/w/user/promotion/available`,n={credentials:"omit"},o={noProcessResponse:!0};try{const t=await this.$wbxHttpClient.fetch(e,n,o).then((t=>t.json()));return null==t?void 0:t.available_items}catch(t){return console.log("Ошибка получения данных о товарах пользователя с бонусами за отзыв"),null}},n._toProductPaymentsInfo=function(t){const e={itemId:t.item_id,promotionId:t.promotion_id,text:t.text||0,photo:t.photo||0,video:t.video||0};return e.total=e.text+e.photo+e.video,e},e}();window.__spaServiceManager__.register("feedbacksPaymentService",e)})();