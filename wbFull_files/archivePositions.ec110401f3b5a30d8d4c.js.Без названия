(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){var i=function(t,i){if("object"!=e(t)||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var r=s.call(t,i||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===i?String:Number)(t)}(t,"string");return"symbol"==e(i)?i:i+""}function i(e,i){for(var s=0;s<i.length;s++){var r=i[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,t(r.key),r)}}const s=Object.freeze({type:0,status:1});let r=!1;const o=[{name:"Все товары",type:s.type,value:"all",order:0,analyticsName:"All"},{name:"Выкупленные",type:s.status,value:544,order:1,analyticsName:"Buyout"},{name:"Отмененные",type:s.status,value:82240,order:2,analyticsName:"Canceled"},{name:"Возврат товара",type:s.status,value:128,order:3,analyticsName:"Returned"}];"ru"==wb.settings.currentLocale&&o.push({name:"Подарочные сертификаты",type:s.type,value:"cert",order:5}),o.push({name:"Рубли за отзыв",type:s.type,value:"payment_feedbacks",order:4,analyticsName:"Feedback_Points"}),o.sort(((e,t)=>e.order-t.order));const a=o.filter((e=>"all"==e.value||"ru"==wb.settings.currentLocale&&"cert"==e.value));let n=function(){function e(e){var t,i,s;this.isNetworkError=e.isNetworkError,this.limit=null!==(t=e.limit)&&void 0!==t?t:150,this.count=null!==(i=e.count)&&void 0!==i?i:0,this.filteredCount=0,this.filters=null!==(s=e.filters)&&void 0!==s?s:{type:"all",status:0},this.courierPrice=e.courierPrice,this.filters.selectedFilter="all",this.showFiltersDropdown=!1,this.updating=!0,this.urls={getArchivePositions:"/webapi/lk/myorders/archive/get",getArchivePositionsByRids:"/webapi/lk/myorders/archive/getbyrids",hideArchivePosition:"/webapi/lk/myorders/archive/hide",getVideoMetadata:"/webapi/video/streaming/metadata/",playVideoStream:"https://v.wildberries.ru/webapi/video/streaming/play/",downloadVideoAttachment:"https://v.wildberries.ru/webapi/video/streaming/download/"},this.hideInfoCert=wb.global.userSettings.closed.includes("hide_tooltip_info_cert"),this.products=[],this.onGetArchive=this.onGetArchive.bind(this),this.debounceArchive=this.$helper.debounce(this.onGetArchive,100),this.chatEnabled=!1,this.actionMenuHelper={showPopupRefund:this.showPopupRefund.bind(this),hideItem:this.hidePosition.bind(this),startSellerChat:this.startSellerChat,startSellerRefund:(e,t)=>this.startSellerChat.call(this,e,t,!0),startClaim:this.startClaim.bind(this),getCertKey:this.getCertKey.bind(this),chatEnabled:()=>this.chatEnabled,showCustomChargesPopup:this.showCustomChargesPopup.bind(this)},this.filters.period&&(this.filters.period+=""),this.archivePeriods=[],e.lastYear>0&&e.startYear>0&&e.lastYear>e.startYear&&(this.archivePeriods=[...Array(1+e.lastYear-e.startYear).keys()].map((t=>e.lastYear-t))),this.allFiltres=o,this.shortFiltres=a,this.managementPanel=null,this.sendPurchaseTypeAnalytics=this.sendPurchaseTypeAnalytics.bind(this),this._onToggleSellersSwitcher=this._onToggleSellersSwitcher.bind(this),this._onChatInited=this._onChatInited.bind(this),this.loadMoreAcrhive=this.loadMoreAcrhive.bind(this),this._updateInstInfoLoaded=this._updateInstInfoLoaded.bind(this),this.remainingPaymentsInfo.depends=["instInfoLoaded"]}var t,n,l,c=e.prototype;return c.onHistoryChange=function(){},c.onBeforeRender=async function(){var e,t,i,s,o;this._addObservers();const a=null===(e=this.$router.queryParams.get("type"))||void 0===e?void 0:e.toLowerCase();this.archiveFilters.some((e=>e.value.toString()===a))&&(this.filters.selectedFilter=a),videojs.xhr.beforeRequest=function(e){return e.headers={"X-Requested-With":"XMLHttpRequest"},e},r||($.views.converters({time:function(e){if(!e)return"0";function t(e){return e>10||e<0?e:"0"+e}var i=Math.floor(e/3600),s=Math.floor(e%3600/60),r=Math.floor(e%60),o=[];return i>0&&o.push(t(i)),o.push(t(s)),o.push(t(r)),o.join(":")}},$.templates.videoPopupTmpl),r=!0);const n=(new Date).getFullYear();$.views.helpers({stopPropagation:e=>e.stopPropagation(),notCurrentYear:e=>e&&new Date(e).getFullYear()!=n},$.templates.archiveTmpl),this.filters.status>=0&&(this.filters.status=this.filters.status.toString()),(null===(i=null===(t=wb.global.settings)||void 0===t?void 0:t.switches)||void 0===i?void 0:i.enableSellersChat)&&null!=(null===(o=null===(s=wb.spa.getMainLayout())||void 0===s?void 0:s.header)||void 0===o?void 0:o.onlineChat)&&this._onChatInited()},c.onAfterRender=async function(){var e,t;location.search.indexOf("newOrder")>0&&(this.showDigitalOrderSuccess(),window.history.replaceState({},"",location.pathname)),this.quickNavDestroyer=wb.quickNav({bottomPx:document.documentElement.clientHeight}),document.addEventListener("click",this),this.count>0||"cert"==this.filters.selectedFilter?this.onGetArchive.call(this):$.observable(this).removeProperty("updating"),!this.chatEnabled&&(null===(t=null===(e=wb.global.settings)||void 0===e?void 0:e.switches)||void 0===t?void 0:t.enableSellersChat)&&this.$eventBus.addEventListener("OnlineChatInited",this._onChatInited),this.$eventBus.addEventListener("SellersChatSwitched",this._onToggleSellersSwitcher),this._initFixedPanel()},c._onToggleSellersSwitcher=function(e){const t=e.detail;$.observable(this).setProperty("chatEnabled",t)},c._onChatInited=function(){$.observable(this).setProperty("chatEnabled",!0)},c.onBeforeUnrender=function(){var e,t;document.removeEventListener("click",this),this.$eventBus.removeEventListener("OnlineChatInited",this._onChatInited),this.$eventBus.removeEventListener("SellersChatSwitched",this._onToggleSellersSwitcher),null===(e=this.managementPanel)||void 0===e||e.destroy(),null===(t=this.quickNavDestroyer)||void 0===t||t.call(this)},c.getScreenName=function(){return"Purchases"},c._initFixedPanel=async function(){if(null!=this.managementPanel)return;const e=await this.$moduleLoader.loadModuleAsync("fixedPanel");this.managementPanel=new e(".j-b-management-panel",{fixedClass:"archive-head--fixed",fixedClassShow:"archive-head--fixed-show"}).init()},c.showDigitalOrderSuccess=function(){wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["i-popup-thanks","shown"],contentClasses:["content"],useCenteredFunction:!0,onShow:e=>{e.querySelector(".content").innerHTML=$.templates.digitalOrderSuccessTmpl()}})},c.clearFilters=function(){const e=this.filters.selectedFilter==this.filters.selectedFilter=="cert"?"cert":"all";this.rememberFilter(e),$.observable(this.filters).setProperty({selectedFilter:e,query:""})},c.clearSearch=function(){$.observable(this.filters).setProperty({query:""})},c.rememberFilter=function(e){window.history.replaceState({},"",location.pathname+"?type="+e),"cert"===e&&wb.analitics.sendEvent("Purchases_TypeList_T",{name:"Certificate"})},c.onGetArchive=async function(){var e;const t=this.filterModel;let i;switch($.observable(this).setProperty("updating",!0),t.type){case"cert":i=this._loadCertificatesAsync(t);break;case"payment_feedbacks":i=this._loadWithPaymentFeedbacks();break;default:i=this._loadProductsArchiveAsync(t)}try{const s=await i;if(!s)return void $.observable(this).removeProperty("updating");if($.observable(this).setProperty({filteredCount:s.archive.length}),t.offset>0?$.observable(this.products).insert(s.archive):$.observable(this.products).refresh(s.archive),"cert"===t.type&&this._handleCertAnalytics(),"cert"===t.type){const t=document.querySelectorAll(".j-cert-btn-analitic");t.length&&(this.showCertOpenBtnObserver=WbSpaModel.prototype.$observerHelper.getSimpleObserver((()=>{WbSpaModel.prototype.$analitic.sendEvent("Share_S",{location:"Purchase",item_id:"9999999999"})}),{threshold:.5}),null===(e=this.showCertOpenBtnObserver)||void 0===e||e.observe([...t]))}this._refreshInstallmentPlansInfo(s.archive),this._loadGoodsRatingInfo(s.archive)}catch(e){console.log(e)}finally{$.observable(this).removeProperty("updating")}return!0},c.onGetArchiveWbx=async function(){const e=this.filterModel;let t=this._allProducts;e.status>0?t=this._allProducts.filter((t=>(e.status&t.bitStatus)==t.bitStatus)):"all"==e.type&&(t=this._allProducts),e.query&&(t=t.filter((t=>{var i,s;return(null===(i=t.name)||void 0===i?void 0:i.toLowerCase().startsWith(e.query.toLowerCase()))||(null===(s=t.brand)||void 0===s?void 0:s.toLowerCase().startsWith(e.query.toLowerCase()))||t.code1S==e.query})));const i=t.length;return this.filters.offset>0?(t=t.slice(this.filters.offset,this.filters.offset+this.limit),$.observable(this.products).insert(t)):(t=t.slice(0,this.limit),$.observable(this.products).refresh(t)),$.observable(this).setProperty({filteredCount:i,updating:!1}),!0},c._loadProductsArchiveAsync=async function(e){const t=new URLSearchParams(e),i=await this.$httpClient.fetchJSON(this.urls.getArchivePositions,{method:"POST",body:t});return i&&i.archive?i:null},c._loadWithPaymentFeedbacks=async function(){const e=await wb.xnm.getFeedbacksPaymentByUser(),t=null==e?void 0:e.map((e=>e.rid)),i={archive:[]};if(!(null==t?void 0:t.length))return i;const s=JSON.stringify(t),r=await this.$httpClient.fetchJSON(this.urls.getArchivePositionsByRids,{method:"POST",headers:{"Content-Type":"application/json"},body:s});return r&&r.archive?(i.archive=r.archive.filter((e=>!e.rating)),i):i},c.sendPurchaseTypeAnalytics=function(e){const{data:t}=$.view(e.currentTarget);t.analyticsName&&this.$analitic.sendEvent("Purchases_TypeList_T",{name:t.analyticsName})},c.sendShareClickAnalytics=function(){this.$analitic.sendEvent("Share_T",{location:"Purchase",item_id:"9999999999"})},c._loadCertificatesAsync=async function(e){if(e.offset>0)return{archive:this.certs.slice(e.offset,e.offset+this.limit),filteredCount:this.certs.length};return await this.$moduleLoader.loadServiceAsync("certificateService"),this.certs=await this.$services.certificateService.getAllCertificates(),""!==e.query&&void 0!==e.query&&(this.certs=this.certs.filter((t=>t.nominal.toString().toLowerCase().startsWith(e.query.toLowerCase())))),{archive:this.certs.slice(0,this.limit),filteredCount:this.certs.length}},c.loadMoreAcrhive=function(){$.observable(this.filters).setProperty({offset:(this.filters.offset||0)+this.limit})},c.openProductPopup=function(e){if(e.target.classList.contains("j-non-refundable")||e.target.classList.contains("j-write-feedback"))return;const{data:t}=$.view(e.currentTarget);if("Certificates"==t.type)return!1;this.$productCardPopup.show(t.code1S,t.characteristicId)},c.showCustomChargesPopup=function(e){e.stopPropagation(),WbSpaModel.prototype.$moduleLoader.loadModuleAsync("customChargesPopup").then((e=>{this.customChargesPopup=new e(e.template,this.customsFeeAmount,this.iSOCurrency),this.customChargesPopup.showPopup()}))},c.nameFromSelectedFilter=function(e){var t;return null===(t=o.find((t=>t.value==e)))||void 0===t?void 0:t.name},c.showVideoContent=function(e){const{data:t}=$.view(e.currentTarget);return this.$httpClient.fetchJSON(this.urls.getVideoMetadata+t.code1S+"/"+t.characteristicId+`?_=${(new Date).getTime()}`).then((e=>{if(1===e.videos.length){let i=this.urls.playVideoStream+t.code1S+"/"+t.characteristicId+"/"+e.videos[0].masterPlaylist;wb.popup.videoPlayer(i,e.videos[0].title)}else wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["popup-video-episode","i-popup-video-episode","shown"],contentClasses:["popup__content"],useCenteredFunction:!0,onShow:i=>{$.templates.videoPopupTmpl.link(i.querySelector(".popup__content"),{videos:e.videos,attachments:e.attachments},{watch:(e,i)=>{let s=this.urls.playVideoStream+t.code1S+"/"+t.characteristicId+"/"+i.linkCtx.data.masterPlaylist;wb.popup.videoPlayer(s,this.title)},downloadUrl:e=>this.urls.downloadVideoAttachment+t.code1S+"/"+t.characteristicId+"/"+e})}})})).catch((e=>{e.isCustomError?wb.popup.renderModalError(e.message):(wb.popup.renderModalError("Ошибка при загрузке контента"),console.error(e))})),!1},c.downloadContent=function(e){const{data:t}=$.view(e.currentTarget);return this.$httpClient.fetchJSON(this.urls.getVideoMetadata+t.code1S+"/"+t.characteristicId+`?_=${(new Date).getTime()}`).then((e=>{if(!e.attachments||0===e.attachments.length)return wb.popup.renderModalError("Нет загруженных файлов");1===e.attachments.length?location.href=this.urls.downloadVideoAttachment+t.code1S+"/"+t.characteristicId+"/"+e.attachments[0].masterPlaylist:wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["popup-video-episode","shown"],contentClasses:["popup__content"],useCenteredFunction:!0,onShow:i=>$.templates.videoPopupTmpl.link(i.querySelector(".popup__content"),{attachments:e.attachments},{downloadUrl:e=>this.urls.downloadVideoAttachment+t.code1S+"/"+t.characteristicId+"/"+e})})})).catch((e=>{e.isCustomError?wb.popup.renderModalError(e.message):(wb.popup.renderModalError("Ошибка при загрузке контента"),console.log(err))})),!1},c.showStatusPopup=function(e,t){const{data:i}=$.view(e.currentTarget);return i.loading||(i.loading=!0,this.$moduleLoader.loadModuleAsync("trackingPopup").then((e=>{(new e).showStatusPopup({rid:i.rId,transitRefund:!0}),i.loading=!1})).finally((()=>i.loading=!1))),!1},c.loadSeller=function(e){var t;const i=$.view(e.currentTarget).data;!i._sellerLoading&&i.sellerChatEnabled&&(i._sellerLoading=!0,this.$httpClient.fetchBasicJSON(wb.helpers.url.urlSellerStatic(i.code1S),{},{nullOnError:!0}).then((e=>{if(!e)return void(this._sellerLoading=!1);const{supplierId:t,supplierName:s,trademark:r}=e;t>0&&32477!==t&&12399!==t&&$.observable(i).setProperty({chatEnabled:!0,sellerId:t,sellerName:r||s})})),null===(t=wb.spa.getMainLayout().header.chatStartedRefunds)||void 0===t||t.promise.then((e=>{const{years:t}=wb.helpers.date.diff(new Date(i.lastDate));t<2&&!e.has(i.rId)&&$.observable(i).setProperty({chatRefundEnabled:!0})})))},c.checkClaim=function(e){const{data:t}=$.view(e.currentTarget);t.claimChecked||(t.claimChecked=!0,"Purchased"==t.status&&(new Date(t.claimExpireDate)<=new Date||t.claimDisabled||(t.claimChecking||(t.claimChecking=this.$getService("claimsService").then((e=>e.checkRid(t.rId))).catch((()=>t.claimChecked=!1))),t.claimChecking.then((e=>{!e&&$.observable(t).setProperty({claimAllowed:!0})})))))},c._refreshInstallmentPlansInfo=async function(e=[]){const t=e.filter((e=>"IWB"===e.paymentType)),i=e.filter((e=>"PDL"===e.paymentType));if(t.length){if(!this._installmentHelper){const e=await this.$moduleLoader.loadModuleAsync("installmentChart");this._installmentHelper=(new e).init()}await this._installmentHelper.loadPaymentPlansInfo(t)}if(i.length){if(!this._commissionInstallmentChart){const e=await this.$moduleLoader.loadModuleAsync("commissionInstallmentChart");this._commissionInstallmentChart=new e(null,this._updateInstInfoLoaded).init()}await this._commissionInstallmentChart.loadPaymentPlansInfo(i)}this._updateInstInfoLoaded()},c._updateInstInfoLoaded=function(){this.$observable.setProperty({instInfoLoaded:Date.now()})},c._loadGoodsRatingInfo=async function(e=[]){const t=e.filter((e=>"Product"===e.type&&e.feedbackAllowed)).map((e=>e.code1S));if(!t.length)return;const i=await this.$httpClient.fetchJSON("/webapi/lk/discussions/feedback/ratingmap",{method:"POST",body:this.$helper.objectSerializer({nmIds:t})});e.forEach((e=>{e.feedbackAllowed&&this.asObservable(e).setProperty({rating:i[e.code1S]})})),wb.xnm.fillFeedbacksPaymentByUser(e)},c.remainingPaymentsInfo=function(e="",t="",i=!1,s=!1){var r,o,a;return"IWB"===t?null!==(o=null===(r=this._installmentHelper)||void 0===r?void 0:r.getRemainingPaymentsInfo(e,i))&&void 0!==o?o:"":null===(a=this._commissionInstallmentChart)||void 0===a?void 0:a.getRemainingPaymentsInfo(e,s)},c.showInstallmentDetailsPopup=function(e="",t="",i){i.stopImmediatePropagation(),"IWB"===t?this._installmentHelper.showPlanDetailsPopup(e):(this._commissionInstallmentChart.showPlanDetailsPopup(e),this._commissionInstallmentChart.sendAnaliticBtn(e,"Loan_Mark_T"))},c.startSellerChat=function(e,t,i){const s=$.view(e.currentTarget).data,{rId:r,shkId:o,name:a,brand:n,size:l,color:c,code1S:d,lastDate:h,sellerId:u,sellerName:p,rawPrice:f,iSOCurrency:m,status:v,country:b,sign:y}=s;if(!u)return;const w=`seller_${u}`,g={rid:r,nmID:d,shkID:o,brand:n,color:c,name:a,size:l,price:f,priceCurrency:m,date:h,statusID:function(){switch(v){case"Purchased":return 11;case"Rejected":return 12;case"Refund":case"TransitRefund":return 13;case"ExcludedFromRate":case"CreditRejected":case"FailedPayment":return 14;case"OnDefectTesting":return 15}return 10}(),site:null==b?void 0:b.toUpperCase(),sign:y};i&&(g.needRefund=!0);const P=[a];if(n&&P.push(`бренд ${n}`),l&&"0"!=l&&P.push(`размер ${l}`),d>0&&P.push(`артикул ${d}`),h){let e="получен";"Refund"==v?e="возвращен":"Rejected"!=v&&"ExcludedFromRate"!=v||(e="отменен"),P.push(`товар ${e} ${new Date(h).format("dd.MM.yyyy")}`)}const S=`Здравствуйте! ${i?"Хочу вернуть товар":"У меня вопрос по товару"} "${P.join(", ")}"`;wb.spa.getMainLayout().header.onlineChat.showChat({chatId:w,sellerId:u,text:S,title:p,goodCard:g,afterSubmit:()=>{i&&$.observable(s).setProperty({chatRefundEnabled:!1})}})},c.startClaim=async function(e){e.preventDefault();const{data:t}=$.view(e.target),{rId:i,code1S:s,name:r,size:o,price:a,currency:n,subjectId:l}=t;(await this.$moduleLoader.loadModuleAsync("claimAdder")).showForItem({rid:i,nmId:s,name:r,size:o,price:a,currency:n,subjectId:l,onSuccess:e=>e&&$.observable(t).setProperty({claimAllowed:!1})})},c.showFeedbackPopup=function(e){const t=$.view(e.target),i=t.data,s=t.ctxPrm("product");if(!s)return;const r={location:"Purchases",item_id:s.code1S};this.$analitic.sendEvent("Item_Feedback_GiveFeedback_T",r);const o={imtId:s.imtId,nmId:s.code1S,goodName:s.name,brandName:s.brand,adult:s.isAdult,sellerId:s.sellerId,feedbacksPaymentInfo:null==s?void 0:s.feedbacksPaymentInfo,country:null==s?void 0:s.country},a={selectedCod1S:{value:s.code1S},selectedSizeName:{value:s.size},selectedRating:i,onSubmit:e=>$.observable(s).setProperty("rating",e.productValuation||e.rating),onError:e=>{e.isUnauthorize||(e.isCustomError?wb.popup.showFeedbackError(e):wb.popup.renderModalError(this.$localziation.serverError))}};Promise.all([this.$moduleLoader.loadServiceAsync("feedbacksService")]).then((()=>{this.$services.feedbacksService.showFeedbacksPopup(o,a,r)}))},c.showPopupRefund=function(e){const{data:t}=$.view(e.currentTarget);Promise.all([this.$moduleLoader.loadModuleAsync("archiveItemRefundPopup"),this.$getService("claimsService").then((e=>e.checkRid(t.rId))),this.$getService("courierRefundsService").then((e=>e.checkRid(t.rId)))]).then((([e,i,s])=>{const r=new e(t);r.claimCreated=i,r.courierCreated=s,r.showPopup()})).catch((e=>console.error(e)))},c.showFeedbacksForPointsPopup=function(e){e.stopPropagation(),this.$moduleLoader.loadModuleAsync("feedbacksForPointsPopup").then((e=>{this.feedbacksForPointsPopup=new e(e.template),this.feedbacksForPointsPopup.showFeedbacksForPointsPopup()}))},c.hidePosition=function(e){const{data:t}=$.view(e.currentTarget);wb.popup.showCustomPopup({useHtml:!0,useCenteredFunction:!0,popupClassesList:["popup-hide-purchase-info","shown"],contentClasses:["popup__content"],lockScroll:!0,onShow:e=>{$.views.templates.hidePurchaseTmpl.link(e.contentEl,{approve:async()=>{try{await this.$httpClient.fetchJSON(this.urls.hideArchivePosition,{method:"POST",body:new URLSearchParams({rid:t.rId})}),$.observable(t).setProperty({hidden:!0}),this.$moduleLoader.execModule("bottomNotificationPanel","showNotification",[0,"Скоро скроем товар"])}catch(e){console.error(e)}}})}})},c._addObservers=function(){$.observe(this.filters,"query","selectedFilter","period",((e,{path:t,value:i})=>{this.filters.offset=0,"query"==t&&this.filters.query?this.filters.query.length>2&&this.debounceArchive.call(this):($.observable(this).setProperty({showFiltersDropdown:!1}),this.debounceArchive.call(this))})),$.observe(this.filters,"offset",(()=>{this.onGetArchive.call(this)}))},c.handleEvent=function(e){"click"==e.type&&document.querySelectorAll(".j-archive-dropdown").forEach((t=>{e.target.closest(".j-archive-dropdown")!=t&&$.view(t).ctxPrm("show",!1)}))},c.showMobileFilter=async function(){this.$moduleLoader.loadModuleAsync("mobilePopupSorter").then((e=>{e.showPopup(this.filters.selectedFilter,this.archiveFilters,this.updateFiltersMobile.bind(this))}))},c.getCertKey=async function(e,t,i){const{data:s}=$.view(i.currentTarget);await this.$moduleLoader.loadServiceAsync("certificateService");let r=await this.$services.certificateService.getPdf(e);if(r.error)return wb.popup.renderModalError(r.error);"issued"!==t&&$.observable(s).setProperty({status:"issued"});const o=new File([r.pdf],"cert.pdf",{type:"application/pdf"}),a=[o];try{if("m"===wb.settings.displayMode&&navigator.canShare({files:a}))return await navigator.share({files:a}),void wb.analitics.sendEvent("Share_Apl",{location:"Purchase",items:"9999999999"})}catch(i){wb.spa.logError(i,"[GIFT_CERT_SVC]: failed to share certificate")}const n=URL.createObjectURL(o),l=document.createElement("a");l.setAttribute("target","_blank"),l.href=n,document.body.appendChild(l),l.click(),document.body.removeChild(l),wb.analitics.sendEvent("Share_Apl",{location:"Purchase",items:"9999999999"})},c.updateFiltersMobile=function(e){this.rememberFilter(e.value),$.observable(this.filters).setProperty({selectedFilter:e.value})},c.closeTooltipCert=function(){$.observable(this).setProperty({hideInfoCert:!0}),wb.global.userSettings.closed.push("hide_tooltip_info_cert"),wb.global.saveUserSettings()},c._handleCertAnalytics=function(){var e;const t=null===(e=null===document||void 0===document?void 0:document.querySelectorAll(".j-cert-observe"))||void 0===e?void 0:e.toArray();this.observer=new IntersectionObserver(((e,i)=>{e.forEach((e=>{e.isIntersecting&&(i.unobserve(e.target),this._sendViewItemCertEvent(e.target,t))}))}),{threshold:.5}),null==t||t.forEach((e=>{this.observer.observe(e)}))},c._sendViewItemCertEvent=function(e,t){const{data:i}=$.view(e),s=t.indexOf(e),r=this.$analitic.getState();r.l="PRC",r.s="",r.t="";const o=[{id:"9999999999",chrt:"",name:"Сертификат",brand:"WB",price:i.nominal,inListIndex:s+1,quantity:1,listName:this.$analitic.analiticsInfoToListName(r),category:"Certificate",tailObject:this.$analitic.getTailObjectFromAnalyticsInfo(Object.assign(Object.assign({},r),{lw:""}))}];this.$analitic.sendWbaEcomStat("view_item_in_list",o,{mark:""})},t=e,(n=[{key:"archiveFilters",get:function(){return 0==this.count?this.shortFiltres:this.allFiltres}},{key:"filterModel",get:function(){const e={limit:this.limit},t=o.find((e=>e.value==this.filters.selectedFilter));if(null!=t)switch(t.type){case s.type:e.type=t.value;break;case s.status:e.type="all",e.status=t.value}if(this.filters.period%2e3>0){var i=(new Date).getFullYear();e.from=new Date(this.filters.period,0,1).format("yyyy-MM-dd"),this.filters.period<i&&(e.to=new Date(this.filters.period,11,31).format("yyyy-MM-dd"))}return this.filters.offset>0&&(e.offset=this.filters.offset),this.filters.query&&this.filters.query.length>2&&(e.query=this.filters.query),e}}])&&i(t.prototype,n),l&&i(t,l),Object.defineProperty(t,"prototype",{writable:!1}),t}();wb.spa.registerViewModel(n)})();