(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e){var o=function(e,o){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,o||"default");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(e)}(e,"string");return"symbol"==t(o)?o:o+""}function o(t,o){for(var n=0;n<o.length;n++){var r=o[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,e(r.key),r)}}function n(t,e){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},n(t,e)}const r="offer/offer_view";let i=function(t){function e(){var e;return e=t.call(this)||this,window.addEventListener("storage",(t=>{var o;t.key===e.key&&localStorage.hasItem(t.key)&&(null===(o=e.popup)||void 0===o||o.close())})),e.deferred=new e.$helper.Deferred,e}var i,s;s=t,(i=e).prototype=Object.create(s.prototype),i.prototype.constructor=i,n(i,s);var a=e.prototype;return a.show=async function(){await this.check()||(this.popup=wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["popup-new-offer","shown"],contentClasses:["popup__content"],useCenteredFunction:!0,keepOpenOnTransition:!0,modal:!1,lockScroll:!0,onShow:t=>{this.template.link(t.contentEl,this)},onHide:(t,e)=>{var o;this.popup=null,(null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.classList.contains("j-close"))&&(this._sendWba("Pop_Up_Close"),this.reject())}}),this._sendWba("Pop_Up_S"))},a.check=async function(){if(this.isConfirmed)return this.deferred.resolve(),!0;const t=await this.$services.apiUserStorage.getList("offer",{timeout:5e3}),e=null==t?void 0:t.some((t=>t.path===r));return!!e&&(localStorage.setItem(this.key,"1"),this.deferred.resolve(),!0)},a.confirmHandler=function(t){var e;this.confirm(),this._sendWba("Pop_Up_T",{button_name:null===(e=t.target)||void 0===e?void 0:e.textContent})},a.confirm=function(){var t;localStorage.setItem(this.key,"1"),this.deferred.resolve(),this.$services.apiUserStorage.setData([{path:`/${r}`,file:"W10="}]),null===(t=this.popup)||void 0===t||t.close()},a.promise=function(){return this.deferred.promise},a.reject=function(){this.deferred.reject(),wb.global.settings.switches.oferta0724Logoff&&wb.spa.getMainLayout().header.signOut()},a.openOffersContentPopup=function(t){const e=window._debug?"3":"10144";Promise.all([this.$moduleLoader.loadModuleAsync("offerContent0724"),$.views.loadWebApiTemplateAsync(e)]).then((([e,o])=>{var n;this.newOfferContentPopup=new e(o),this.newOfferContentPopup.showNewOfferContentPopup(),this._sendWba("Pop_Up_T",{button_name:null===(n=t.target)||void 0===n?void 0:n.textContent})}))},a._sendWba=function(t,e){var o,n;this.$analitic.sendEvent(t,Object.assign({location:null===(n=null===(o=this.$router.viewModel)||void 0===o?void 0:o.getScreenName)||void 0===n?void 0:n.call(o),name:this.title,type:"Accept_Offer"},e||{}))},function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"title",get:function(){return"Мы обновили правила площадки"}},{key:"template",get:function(){return $.templates('<div class="popup__picture"></div><div class="popup__main"><h3 class="popup__title">'+this.title+'</h3><p class="popup__text">Я ознакомился и согласен с <button class="popup__offers-button" data-link="{on openOffersContentPopup}">документами</button></p><button class="popup__close-button btn-main" data-link="{on confirmHandler}">Спасибо, всё понятно</button></div>')}},{key:"key",get:function(){return`_oferta0724_${this.$auth.um.userUid}`}},{key:"isConfirmed",get:function(){return!wb.global.settings.switches.oferta0724||!this.$auth.isAuth||localStorage.hasItem(this.key)}}])}(WbSpaModel);window.__spaModuleManager__.register("offer0724",i)})();